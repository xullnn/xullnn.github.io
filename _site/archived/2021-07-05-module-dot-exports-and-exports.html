<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>The difference between module.exports and exports in Node.js</title>
<!-- The styles.css referenced here is generated by Jekyll from the styles.scss -->
    <link rel="stylesheet" href="/assets/css/styles.css">
  </head>
  <body>
      <div class="post">

  <!-- <nav>
  
    <a href="/" >
      Home
    </a>
  
    <a href="/blog.html" >
      Blog
    </a>
  
    <a href="photography.html" >
      Photography
    </a>
  
    <a href="/me.html" >
      Me
    </a>
  
</nav> -->


<!-- <div class="bar_nav">
  <p>Home</p>
  <p>Portfolio</p>
  <p>Blog</p>
  <p>Me</p>
</div> -->


<div class="bar_nav">
  
    
    <p ><a href="/">Home</a></p>
  
    
    <p  class="current" ><a href="/blog.html">Blog</a></p>
  
    
    <p ><a href="photography.html">Photography</a></p>
  
    
    <p ><a href="/me.html">Me</a></p>
  
</div>

  <h1>The difference between module.exports and exports in Node.js</h1>
  <p>05 Jul 2021</p>


  <p><em>This post discusses the difference between <code>module.exports</code> and <code>exports</code> in the context of <code>Node.js</code>.</em></p>

<p>Exporting and importing modules are common operations in a Node app.</p>

<div class="language-js highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span><span style="color:#777">// toBeExported.js</span>
<span class="line-numbers"><a href="#n2" name="n2">2</a></span><span style="color:#080;font-weight:bold">function</span> <span style="color:#06B;font-weight:bold">f</span>() {  };
<span class="line-numbers"><a href="#n3" name="n3">3</a></span>module.exports.f = f;
<span class="line-numbers"><a href="#n4" name="n4">4</a></span>  <span style="color:#777">// or exports.f = f;</span>
<span class="line-numbers"><strong><a href="#n5" name="n5">5</a></strong></span>
<span class="line-numbers"><a href="#n6" name="n6">6</a></span><span style="color:#777">// toImport.js</span>
<span class="line-numbers"><a href="#n7" name="n7">7</a></span>const { f } = require(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">./toBeExported</span><span style="color:#710">&quot;</span></span>);
<span class="line-numbers"><a href="#n8" name="n8">8</a></span>  <span style="color:#777">// or const f = require(&quot;./toBeExported&quot;).f;</span>
</pre></div>
</div>
</div>

<p>And I was once confused by the different exporting syntax of <code>module.exports</code> and <code>exports</code>.
A lot of articles on the internet and the <a href="https://nodejs.org/api/modules.html#modules_exports_shortcut">node doc</a> explains this topic in various level. Practically , there’s a simpler way to understand the difference.</p>

<h2 id="an-object-and-a-variable-that-references-it">An object and a variable that references it</h2>

<p>Let’s do some warmup.</p>

<p>If we have an nested object <code>nested_object</code>:</p>

<div class="language-js highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"> <a href="#n1" name="n1">1</a></span>const nested_object = {
<span class="line-numbers"> <a href="#n2" name="n2">2</a></span>  <span style="color:#606">a</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">hello world</span><span style="color:#710">'</span></span>,
<span class="line-numbers"> <a href="#n3" name="n3">3</a></span>  <span style="color:#606">x</span>: {
<span class="line-numbers"> <a href="#n4" name="n4">4</a></span>    <span style="color:#606">f</span>: () =&gt; { console.log(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">I am a func</span><span style="color:#710">'</span></span>)},
<span class="line-numbers"> <strong><a href="#n5" name="n5">5</a></strong></span>    <span style="color:#606">p</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">nested</span><span style="color:#710">'</span></span>
<span class="line-numbers"> <a href="#n6" name="n6">6</a></span>  }
<span class="line-numbers"> <a href="#n7" name="n7">7</a></span>};
<span class="line-numbers"> <a href="#n8" name="n8">8</a></span>
<span class="line-numbers"> <a href="#n9" name="n9">9</a></span>let x = nested_object.x; <span style="color:#777">// references the nested object</span>
<span class="line-numbers"><strong><a href="#n10" name="n10">10</a></strong></span>
<span class="line-numbers"><a href="#n11" name="n11">11</a></span>x.another_f = () =&gt; { console.log(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">I am also a func</span><span style="color:#710">'</span></span>) };
<span class="line-numbers"><a href="#n12" name="n12">12</a></span>
<span class="line-numbers"><a href="#n13" name="n13">13</a></span>nested_object.x;
</pre></div>
</div>
</div>

<p>Is <code>another_f</code> injected in the nested object <code>nested_object.x;</code>?</p>

<p>Yes of course. Because the local variable <code>x</code> is referencing the nested object which is also a property of <code>nested_object</code>. So the property <code>x</code> and variable <code>x</code> are pointing to the same object, changes made by either side will be reflected on the commonly referencing object.</p>

<p>What if we reassign the local variable <code>x</code>:</p>

<div class="language-js highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span><span style="color:#777">// ... omit code</span>
<span class="line-numbers"><a href="#n2" name="n2">2</a></span>
<span class="line-numbers"><a href="#n3" name="n3">3</a></span>x = {
<span class="line-numbers"><a href="#n4" name="n4">4</a></span>  <span style="color:#606">newF</span>: () =&gt; {console.log(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">I am new func</span><span style="color:#710">'</span></span>)}
<span class="line-numbers"><strong><a href="#n5" name="n5">5</a></strong></span>};
</pre></div>
</div>
</div>
<p>How would this affect the <code>nested_object.x</code>? No effect, this simply lets the local <code>x</code> lose its original reference to the nested object.</p>

<h2 id="the-scope-of-exports-is-local-to-the-current-file">The scope of <code>exports</code> is local to the current file</h2>

<p>You might have guessed that the <code>nested_object</code> implied <code>module</code> and <code>x</code> implied <code>exports</code>. The relationship of <code>module.exports</code> and <code>exports</code> is pretty much just like that.</p>

<p>The <a href="https://nodejs.org/api/modules.html#modules_exports_shortcut">node doc</a> writes:</p>

<blockquote>
  <p>The <code>exports</code> variable is available within a module’s file-level scope, and is assigned the value of module.exports before the module is evaluated.</p>
</blockquote>

<blockquote>
  <p>It allows a shortcut, so that module.exports.f = … can be written more succinctly as exports.f = …. However, be aware that like any variable, if a new value is assigned to exports, it is no longer bound to module.exports</p>
</blockquote>

<p>So <code>exports</code> is just a shortcut in the current file to reference the <code>module.exports</code> object. The actual object that will be exported is the <code>module.exports</code>, so a reassignment to the <code>exports</code> variable does nothing more than losing its use.</p>

<p>Following this logic, a reassignment to <code>module.exports</code> will also disable the <code>exports</code> because “(<code>exports</code>) is assigned the value of <code>module.exports</code> before the module(file) is evaluated”. This means the referential relation is built right after the <code>module</code> instance object is instantiated and before all the functions and properties are written in it. It may look like:</p>

<div class="language-js highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"> <a href="#n1" name="n1">1</a></span><span style="color:#080;font-weight:bold">class</span> Module {
<span class="line-numbers"> <a href="#n2" name="n2">2</a></span>  constructor() {
<span class="line-numbers"> <a href="#n3" name="n3">3</a></span>    <span style="color:#606">exports</span>: {}
<span class="line-numbers"> <a href="#n4" name="n4">4</a></span>  }
<span class="line-numbers"> <strong><a href="#n5" name="n5">5</a></strong></span>};
<span class="line-numbers"> <a href="#n6" name="n6">6</a></span>
<span class="line-numbers"> <a href="#n7" name="n7">7</a></span>const module = <span style="color:#080;font-weight:bold">new</span> Module();
<span class="line-numbers"> <a href="#n8" name="n8">8</a></span>
<span class="line-numbers"> <a href="#n9" name="n9">9</a></span>let exports = module.exports;
<span class="line-numbers"><strong><a href="#n10" name="n10">10</a></strong></span>
<span class="line-numbers"><a href="#n11" name="n11">11</a></span><span style="color:#777">// Then write functions and properties exported into module.exports</span>
</pre></div>
</div>
</div>

<p>And this entails a bonus point. What’s the <code>module</code> under the context of a module file?</p>

<h2 id="module-is-an-instance-object"><code>module</code> is an instance object</h2>

<p>Often in a project, there are multiple modules to be exported, we may do <code>module.exports = objectA;</code> in one file, and <code>module.exports  = objectB</code> in another file. Are we dealing with the same <code>module</code> here?</p>

<p>If the answer was ‘yes’ then all the exporting operations were just messing things up. We can do a simple investigation within a module file.</p>

<p>We can try <code>console.log(module)</code> or simply evaluate <code>module</code> in <code>Node</code> console, it logs:</p>

<div class="language-js highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"> <a href="#n1" name="n1">1</a></span>Module {
<span class="line-numbers"> <a href="#n2" name="n2">2</a></span>  <span style="color:#606">id</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">&lt;repl&gt;</span><span style="color:#710">'</span></span>,
<span class="line-numbers"> <a href="#n3" name="n3">3</a></span>  <span style="color:#606">path</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">.</span><span style="color:#710">'</span></span>,
<span class="line-numbers"> <a href="#n4" name="n4">4</a></span>  <span style="color:#606">exports</span>: {},
<span class="line-numbers"> <strong><a href="#n5" name="n5">5</a></strong></span>  <span style="color:#606">parent</span>: <span style="color:#069">undefined</span>,
<span class="line-numbers"> <a href="#n6" name="n6">6</a></span>  <span style="color:#606">filename</span>: <span style="color:#069">null</span>,
<span class="line-numbers"> <a href="#n7" name="n7">7</a></span>  <span style="color:#606">loaded</span>: <span style="color:#069">false</span>,
<span class="line-numbers"> <a href="#n8" name="n8">8</a></span>  <span style="color:#606">children</span>: [],
<span class="line-numbers"> <a href="#n9" name="n9">9</a></span>  <span style="color:#606">paths</span>: [
<span class="line-numbers"><strong><a href="#n10" name="n10">10</a></strong></span>    <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/Users/xullnn/blog/repl/node_modules</span><span style="color:#710">'</span></span>,
<span class="line-numbers"><a href="#n11" name="n11">11</a></span>    <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/Users/xullnn/blog/node_modules</span><span style="color:#710">'</span></span>,
<span class="line-numbers"><a href="#n12" name="n12">12</a></span>    <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/Users/xullnn/node_modules</span><span style="color:#710">'</span></span>,
<span class="line-numbers"><a href="#n13" name="n13">13</a></span>    <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/Users/node_modules</span><span style="color:#710">'</span></span>,
<span class="line-numbers"><a href="#n14" name="n14">14</a></span>    <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/node_modules</span><span style="color:#710">'</span></span>,
<span class="line-numbers"><strong><a href="#n15" name="n15">15</a></strong></span>    <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/Users/xullnn/.node_modules</span><span style="color:#710">'</span></span>,
<span class="line-numbers"><a href="#n16" name="n16">16</a></span>    <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/Users/xullnn/.node_libraries</span><span style="color:#710">'</span></span>,
<span class="line-numbers"><a href="#n17" name="n17">17</a></span>    <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/usr/local/Cellar/node/14.11.0/lib/node</span><span style="color:#710">'</span></span>
<span class="line-numbers"><a href="#n18" name="n18">18</a></span>  ]
<span class="line-numbers"><a href="#n19" name="n19">19</a></span>}
</pre></div>
</div>
</div>

<p>First on the top there’s the <code>Module</code>. This indicates <code>module</code> in the current file is an instance of a class called <code>Module</code>. We can check this in <code>Node</code>:</p>

<div class="language-js highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>module.constructor.name
<span class="line-numbers"><a href="#n2" name="n2">2</a></span>
<span class="line-numbers"><a href="#n3" name="n3">3</a></span><span style="color:#777">// =&gt; 'Module'</span>
</pre></div>
</div>
</div>

<p>So for each module file, new <code>Module</code> instance will be created instead of using a global <code>module</code> object that can be rewritten everywhere in the project.</p>

<p>When we import a module by using <code>const objectA = require(./path/to/module_file)</code>, this line only imports the <code>module.exports</code> object specific to the file being exported.</p>

<p>Second notice the <code>exports</code> property, that’s just the manifestation of the ‘nested object’ we just talked about.</p>

<p>Third is the <code>paths</code> array, which is the <a href="https://nodejs.org/api/modules.html#modules_module_paths">search paths</a> for the <code>module</code>.</p>

<h2 id="summary">Summary</h2>

<p>Normally we tend not to use different syntaxes for the same feature in our code for example we may not use both <code>module.exports</code> and <code>exports</code> in a single file. I think if <code>exports</code> confused people so much, then this so called “shortcut” has little value. But the difference is easy to understand once we find the proper perspective.</p>


</div>

  </body>
</html>